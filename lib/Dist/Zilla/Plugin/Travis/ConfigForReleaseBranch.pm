package Dist::Zilla::Plugin::Travis::ConfigForReleaseBranch;

# ABSTRACT: Create a .travis.yml suitable for built branches

use Moose;
use namespace::autoclean;
extends 'Dist::Zilla::Plugin::InlineFiles';

=head1 SYNOPSIS

    ; in your dist.ini
    [Travis::ConfigForReleaseBranch]

=head1 DESCRIPTION

This is a simple L<Dist::Zilla::Plugin::InlineFiles> plugin to include a
sensible -- or so this author believes -- C<.travis.yml> suitable for running
L<Travis-CI jobs|http://travis-ci.org> off of a release branch like one
generated by the L<Dist::Zilla::Plugin::Git::CommitBuild>
plugin.

By default, we build against Perl 5.8, 5.10, 5.12, 5.14, 5.16 and 5.18.
The 5.8 build job is allowed to fail without causing the entire build run
to fail.

=head1 EARLY VERSION!

Yep, this is an early, early version.  No tests, and no flexibility in
configuration details.  Anyone wishing to assist (and faster than this author
in remedying this sad, sad state of affairs) is more than welcome to submit
pull requests.  Good pull requests are likely to earn the undying gratitude of
this humble CPAN author.

=head1 SEE ALSO

Dist::Zilla::Plugin::Git::CommitBuild

Dist::Zilla::TravisCI

=cut

__PACKAGE__->meta->make_immutable;
!!42;

__DATA__
___[ .travis.yml ]___
# use the container-based infrastructure
sudo: false

language: perl
perl:
   - "5.8"
   - "5.10"
   - "5.12"
   - "5.14"
   - "5.16"
   - "5.18"
   - "5.20"

matrix:
   allow_failures:
      - perl: "5.8"

before_install:
   # git bits sometimes needed...
   - git config user.name 'Travis-CI'
   - git config user.email 'travis@nowhere.dne'

install:
   # not so much install our package as all its prereqs
   - cpanm --installdeps -q --skip-satisfied . || { cat ~/.cpanm/build.log ; false ; }

script:
   - perl Makefile.PL
   - make test
